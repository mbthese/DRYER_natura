geom_boxplot() +
scale_fill_manual(
values = c(leaf = "#6bbf59",
root = "#E79F02"))+
ylab(expression(paste("Alpha diversity / fungi")))+ #\n jump line
theme_minimal(base_size = 20)+
geom_text(aes(x = 3, y = 250, label = "p-value < 0.001"), color = "black", size = 6)+
theme(axis.text.x = element_blank(), axis.title.x = element_blank(),legend.position = "none")
alpha_ITS_plot_leaf_rarefy
#combine plots ITS leaf and root
alpha_ITS_plot <- ggarrange(alpha_ITS_plot_leaf_rarefy ,alpha_ITS_plot_root_rarefy , labels = c('A', 'B'), ncol = 2, nrow = 1, legend = "none", label.y = c(1,1), font.label = list(size=18))
#combine plots ITS leaf and root
alpha_ITS_plot_rarefy <- ggarrange(alpha_ITS_plot_leaf_rarefy ,alpha_ITS_plot_root_rarefy , labels = c('A', 'B'), ncol = 2, nrow = 1, legend = "none", label.y = c(1,1), font.label = list(size=18))
alpha_ITS_plot_rarefy
load("./resources/Metabarlist_natura_clean_16S_traits.Rdata")
#save(leaf, file = "./results/Metabarlist_natura_clean_16S_leaf_traits.Rdata")
load("./resources/Metabarlist_natura_clean_16S_traits.Rdata")
leaf <- subset_metabarlist(natura_clean, table = "samples",
indices = natura_clean$samples$organ == "leaf")
leaf_data <- leaf$reads
leaf_data <- as.data.frame(leaf_data)
essai <-  leaf_data %>%
rownames_to_column(var = "group") %>%
pivot_longer(cols = -group)
min_n_seqs <- essai %>%
group_by(group)%>%
summarize(nseq=sum(value))%>%
summarize(min = min(nseq)) %>%
pull(min) # 6317
essai_df <- essai %>% pivot_wider(names_from = "name", values_from = "value") %>%
as.data.frame()
essai_df <- essai %>% pivot_wider(names_from = "name", values_from = "value") %>%
as.data.frame()
rownames(essai_df) <- essai_df$group
essai <- essai_df[,-1]
rarefy(essai, min_n_seqs) %>%
as_tibble(rownames="Group") %>%
dplyr::select(Group, vegan=value)
leaf_rarefy <- rrarefy(essai, min_n_seqs) %>%
as_tibble(rownames = "Group") %>%
pivot_longer(-Group)
root <- subset_metabarlist(natura_clean, table = "samples",
indices = natura_clean$samples$organ == "root")
root_data <- root$reads
root_data <- as.data.frame(root_data)
essai <-  root_data %>%
rownames_to_column(var = "group") %>%
pivot_longer(cols = -group)
min_n_seqs_roots <- essai %>%
group_by(group)%>%
summarize(nseq=sum(value))%>%
summarize(min = min(nseq)) %>%
pull(min) # 2434
essai_df <- essai %>% pivot_wider(names_from = "name", values_from = "value") %>%
as.data.frame()
rownames(essai_df) <- essai_df$group
essai <- essai_df[,-1]
min_n_seqs_roots <- essai %>%
group_by(group)%>%
summarize(nseq=sum(value))%>%
summarize(min = min(nseq)) %>%
pull(min) # 1195
rownames(essai_df) <- essai_df$group
essai <- essai_df[,-1]
rarefy(essai, min_n_seqs_roots) %>%
as_tibble(rownames="Group") %>%
dplyr::select(Group, vegan=value)
root_rarefy <- rrarefy(essai, min_n_seqs_roots) %>%
as_tibble(rownames = "Group") %>%
pivot_longer(-Group)
leaf_rarefy_df <- leaf_rarefy %>% pivot_wider(names_from = "name", values_from = "value") %>%
as.data.frame()
rownames(leaf_rarefy_df) <- leaf_rarefy_df$Group
leaf_rarefy_df <- leaf_rarefy_df[,-1]
leaf_rarefy_df <- leaf_rarefy %>% pivot_wider(names_from = "name", values_from = "value") %>%
as.data.frame()
rownames(leaf_rarefy_df) <- leaf_rarefy_df$Group
leaf_rarefy_df <- leaf_rarefy_df[,-1]
#Hill numbers, using HillR package
Shannon_bacteria_leaf_rarefy <-hill_taxa(leaf_rarefy_df,q=1) #equivalent of Shannon entropy
df <- Shannon_bacteria_leaf_rarefy %>%
enframe() %>%
rename(Shannon_rarefy = value,
sample_id = name)
leaf$samples <- left_join(leaf$samples, df, by="sample_id")
#root
root_rarefy_df <- root_rarefy %>% pivot_wider(names_from = "name", values_from = "value") %>%
as.data.frame()
rownames(root_rarefy_df) <- root_rarefy_df$Group
root_rarefy_df <- root_rarefy_df[,-1]
#Hill numbers, using HillR package
Shannon_bacteria_root_rarefy <-hill_taxa(root_rarefy_df,q=1) #equivalent of Shannon entropy
df <- Shannon_bacteria_root_rarefy %>%
enframe() %>%
rename(Shannon_rarefy = value,
sample_id = name)
root$samples <- left_join(root$samples, df, by="sample_id")
shapiro.test(leaf$samples$Shannon_rarefy)
shannon.anova.leaf<-aov(Shannon_rarefy ~ Name, leaf$samples)
summary(shannon.anova.leaf) #8.74e-07 ***
alpha_16S_plot_leaf_rarefy <- leaf$samples  %>%
mutate(name = paste0(substr(Genus, 1, 1), ".", " ", Species) ) %>%
ggplot() +
aes(x = name, y = Shannon_rarefy, fill = organ) +
geom_boxplot() +
scale_fill_manual(
values = c(leaf = "#6bbf59",
root = "#E79F02"))+
ylab(expression(paste("Alpha diversity / bacteria")))+ #\n jump line
theme_minimal(base_size = 20)+
geom_text(aes(x = 3, y = 250, label = "p-value < 0.001"), color = "black", size = 6)+
theme(axis.text.x = element_blank(), axis.title.x = element_blank(),legend.position = "none")
#root
shapiro.test(root$samples$Shannon_rarefy)
shannon.anova.root<-aov(Shannon_rarefy ~ Name, root$samples)
summary(shannon.anova.root) #0.00349 **
alpha_16S_plot_root_rarefy <- root$samples  %>%
mutate(name = paste0(substr(Genus, 1, 1), ".", " ", Species) ) %>%
ggplot() +
aes(x = name, y = Shannon_rarefy, fill = organ) +
geom_boxplot() +
scale_fill_manual(
values = c(leaf = "#6bbf59",
root = "#E79F02"))+
ylab(expression(paste("Alpha diversity / bacteria")))+ #\n jump line
theme_minimal(base_size = 20)+
geom_text(aes(x = 3, y = 250, label = "p-value = 0.5"), color = "black", size = 6)+
theme(axis.text.x = element_blank(), axis.title.x = element_blank(),legend.position = "none")
#combine plots 16S leaf and root
alpha_16S_plot_rarefy <- ggarrange(alpha_16S_plot_leaf_rarefy ,alpha_16S_plot_root_rarefy , labels = c('A', 'B'), ncol = 2, nrow = 1, legend = "none", label.y = c(1,1), font.label = list(size=18))
alpha_16S_plot_rarefy
#combine plots 16S leaf and root
alpha_16S_plot_rarefy <- ggarrange(alpha_16S_plot_leaf_rarefy ,alpha_16S_plot_root_rarefy , labels = c('C', 'D'), ncol = 2, nrow = 1, legend = "none", label.y = c(1,1), font.label = list(size=18))
alpha_16S_plot_rarefy
#traits normalized
traits_norm <- read_csv("resources/DRYER_natura_imputed_traits_norm.csv")
traits_norm$code <- as.character(traits_norm$code)
traits <- left_join(leaf$samples %>% dplyr::select(code, Shannon), traits_norm)
shapiro.test(traits$Shannon) # normal
leaf$samples
traits <- left_join(leaf$samples %>% dplyr::select(code, Shannon_rarefy), traits_norm)
#test normality shannon
ggqqplot(traits$Shannon)
#test normality shannon
ggqqplot(traits$Shannon_rarefy)
ggdensity(traits$Shannon_rarefy)
shapiro.test(traits$Shannon_rarefy) # normal
#traits
names(traits)
env <- traits[,c(2,7,40:45,33:36)] #only leaf traits
# Prior to constructing the model, root functional trait variables were mean-centered and scaled to unit variance.
names(env)
env.scale <- scale(env[,-c(1,2)], center = TRUE, scale = TRUE) #scale traits not the indices
env.scale <-as.data.frame(env.scale)
rest <- env[,c(1,2)]
env.scale <- cbind(env.scale, rest)
#check collinearity with VIF on lm (<5)
names(env.scale)
lm.leaf.16S <-lm(Shannon~ norm_LSWC + norm_StomatalDensity +norm_LT +norm_gmin + norm_SLA + norm_TotalLeafArea+Name+ MEM1 + MEM2+MEM3+MEM4, env.scale)
lm.leaf.16S <-lm(Shannon_rarefy~ norm_LSWC + norm_StomatalDensity +norm_LT +norm_gmin + norm_SLA + norm_TotalLeafArea+Name+ MEM1 + MEM2+MEM3+MEM4, env.scale)
summary(lm.leaf.16S)
vif(lm.leaf.16S) #nothing to remove all <5
lm.leaf.16S.step<-stepAIC(lm.leaf.16S,direction="both")
vif(lm.leaf.16S.step) # <10
summary(lm.leaf.16S.step)
vif(lm.leaf.16S.step) # <10
summary(lm.leaf.16S.step)
RsquareAdj(lm.leaf.16S.step)
library(jtools)
table <- data.frame(summ(lm.leaf.16S.step)$coeftable)
write.csv(table, "Shannon_leaf_bacteria_rarefy.csv")
#traits normalized
traits_norm <- read_csv("resources/DRYER_natura_imputed_traits_norm.csv")
traits_norm$code <- as.character(traits_norm$code)
traits <- left_join(root$samples %>% dplyr::select(code, Shannon_rarefy), traits_norm)
#test normality shannon
ggqqplot(traits$Shannon)
ggdensity(traits$Shannon)
shapiro.test(traits$Shannon) # normal pvalue>0.05
#traits
names(traits)
env <- traits[,c(7,2, 46:48,33:36)] #only root traits
# Prior to constructing the model, root functional trait variables were mean-centered and scaled to unit variance.
names(env)
env.scale <- scale(env[,-c(1,2)], center = TRUE, scale = TRUE) #scale traits not the indices
env.scale <-as.data.frame(env.scale)
rest <- env[,c(1,2)]
env.scale <- cbind(env.scale, rest)
#check collinearity with VIF on lm (<5)
names(env.scale)
lm.root.16S <-lm(Shannon_rarefy~ norm_RootTissueDensity +  norm_SRL + norm_RootDiameter + MEM1+MEM2+MEM3+MEM4, env.scale)
summary(lm.root.16S)
vif(lm.root.16S) #nothing to remove all <5
lm.root.16S.step<-stepAIC(lm.root.16S,direction="both")
vif(lm.root.16S.step) # <5
sum.root.16S <- summary(lm.root.16S.step)
plot(lm.root.16S.step)
shapiro.test(residuals(lm.root.16S.step)) #Shapiro-Wilk normality test
#
#data:  residuals(lm.root.16S.step)
#W = 0.97594, p-value = 0.3019
#table
d<- summ(lm.root.16S.step)
RsquareAdj(lm.root.16S.step)
sum.root.16S
table <- data.frame(summ(lm.root.16S.step)$coeftable)
write.csv(table, "Shannon_root_bacteria_rarefy.csv")
#data
load("E:/Sophie_pipeline/obitools/resources/Metabarlist_natura_clean_ITS2_traits.Rdata")
leaf <- subset_metabarlist(natura_clean, table = "samples",
indices = natura_clean$samples$organ == "leaf")
leaf_data <- leaf$reads
leaf_data <- as.data.frame(leaf_data)
essai <-  leaf_data %>%
rownames_to_column(var = "group") %>%
pivot_longer(cols = -group)
min_n_seqs <- essai %>%
group_by(group)%>%
summarize(nseq=sum(value))%>%
summarize(min = min(nseq)) %>%
pull(min) # 6317
essai_df <- essai %>% pivot_wider(names_from = "name", values_from = "value") %>%
as.data.frame()
rownames(essai_df) <- essai_df$group
essai <- essai_df[,-1]
rarefy(essai, min_n_seqs) %>%
as_tibble(rownames="Group") %>%
dplyr::select(Group, vegan=value)
leaf_rarefy <- rrarefy(essai, min_n_seqs) %>%
as_tibble(rownames = "Group") %>%
pivot_longer(-Group)
root <- subset_metabarlist(natura_clean, table = "samples",
indices = natura_clean$samples$organ == "root")
root_data <- root$reads
root_data <- as.data.frame(root_data)
essai <-  root_data %>%
rownames_to_column(var = "group") %>%
pivot_longer(cols = -group)
min_n_seqs_roots <- essai %>%
group_by(group)%>%
summarize(nseq=sum(value))%>%
summarize(min = min(nseq)) %>%
pull(min) # 2434
essai_df <- essai %>% pivot_wider(names_from = "name", values_from = "value") %>%
as.data.frame()
rownames(essai_df) <- essai_df$group
essai <- essai_df[,-1]
rarefy(essai, min_n_seqs_roots) %>%
as_tibble(rownames="Group") %>%
dplyr::select(Group, vegan=value)
root_rarefy <- rrarefy(essai, min_n_seqs_roots) %>%
as_tibble(rownames = "Group") %>%
pivot_longer(-Group)
leaf_rarefy_df <- leaf_rarefy %>% pivot_wider(names_from = "name", values_from = "value") %>%
as.data.frame()
rownames(leaf_rarefy_df) <- leaf_rarefy_df$Group
leaf_rarefy_df <- leaf_rarefy_df[,-1]
#Hill numbers, using HillR package
Shannon_fungi_leaf_rarefy <-hill_taxa(leaf_rarefy_df,q=1) #equivalent of Shannon entropy
df <- Shannon_fungi_leaf_rarefy %>%
enframe() %>%
rename(Shannon_rarefy = value,
sample_id = name)
leaf$samples <- left_join(leaf$samples, df, by="sample_id")
#root
root_rarefy_df <- root_rarefy %>% pivot_wider(names_from = "name", values_from = "value") %>%
as.data.frame()
rownames(root_rarefy_df) <- root_rarefy_df$Group
root_rarefy_df <- root_rarefy_df[,-1]
#Hill numbers, using HillR package
Shannon_fungi_root_rarefy <-hill_taxa(root_rarefy_df,q=1) #equivalent of Shannon entropy
df <- Shannon_fungi_root_rarefy %>%
enframe() %>%
rename(Shannon_rarefy = value,
sample_id = name)
root$samples <- left_join(root$samples, df, by="sample_id")
root$samples
#traits normalized
traits_norm <- read_csv("resources/DRYER_natura_imputed_traits_norm.csv")
traits_norm$code <- as.character(traits_norm$code)
traits <- left_join(leaf$samples %>% dplyr::select(code, Shannon_rarefy), traits_norm)
#test normality shannon
ggqqplot(traits$Shannon_rarefy)
ggdensity(traits$Shannon_rarefy)
shapiro.test(traits$Shannon_rarefy) # non normal p-value<0.0001
#transform Shannon to meet normality
bc<-boxcox(traits$Shannon_rarefy~1)
(lambda <- bc$x[which.max(bc$y)])
## 2
new_model <- lm(((traits$Shannon_rarefy^lambda-1)/lambda) ~ 1)
qqnorm(new_model$residuals)
qqline(new_model$residuals)
traits$norm_Shannon_rarefy<-(traits$Shannon_rarefy^lambda-1)/lambda
#traits
names(traits)
env <- traits[,c(7,40:45,33:36, 51)] #only leaf traits
# Prior to constructing the model, root functional trait variables were mean-centered and scaled to unit variance.
names(env)
env.scale <- scale(env[,-c(1,12)], center = TRUE, scale = TRUE) #scale traits not the indices
env.scale <-as.data.frame(env.scale)
rest <- env[,c(1,12)]
env.scale <- cbind(env.scale, rest)
#check collinearity with VIF on lm (<5)
names(env.scale)
lm.leaf.ITS <-lm(norm_Shannon_rarefy~ norm_LSWC +
norm_StomatalDensity +
norm_LT +
norm_gmin +
norm_SLA +
norm_TotalLeafArea+
Name+
MEM1 +
MEM2+
MEM3+
MEM4, data=env.scale)
summary(lm.leaf.ITS)
vif(lm.leaf.ITS) #nothing to remove all <5
lm.leaf.ITS.step<-stepAIC(lm.leaf.ITS,direction="both")
vif(lm.leaf.ITS.step) # <10
summary(lm.leaf.ITS.step)
plot(lm.leaf.ITS.step)
table <- data.frame(summ(lm.leaf.ITS.step)$coeftable)
write.csv(table, "Shannon_leaf_fungi_rarefy.csv")
#traits normalized
traits_norm <- read_csv("resources/DRYER_natura_imputed_traits_norm.csv")
traits_norm$code <- as.character(traits_norm$code)
traits <- left_join(root$samples %>% dplyr::select(code, Shannon_rarefy), traits_norm)
#test normality shannon
ggqqplot(traits$Shannon_rarefy)
ggdensity(traits$Shannon_rarefy)
shapiro.test(traits$Shannon_rarefy) # non normal p-value<0.0001
#transform Shannon to meet normality
bc<-boxcox(traits$Shannon~1)
#transform Shannon to meet normality
bc<-boxcox(traits$Shannon_rarefy~1)
(lambda <- bc$x[which.max(bc$y)])
## 2
new_model <- lm(((traits$Shannon_rarefy^lambda-1)/lambda) ~ 1)
qqnorm(new_model$residuals)
qqline(new_model$residuals)
traits$norm_Shannon_rarefy<-(traits$Shannon_rarefy^lambda-1)/lambda
#traits
names(traits)
env <- traits[,c(7,46:48,33:36, 51)] #only root traits
# Prior to constructing the model, root functional trait variables were mean-centered and scaled to unit variance.
names(env)
env.scale <- scale(env[,-c(1,9)], center = TRUE, scale = TRUE) #scale traits not the indices
env.scale <-as.data.frame(env.scale)
rest <- env[,c(1,9)]
env.scale <- cbind(env.scale, rest)
#check collinearity with VIF on lm (<5)
names(env.scale)
lm.root.ITS <-lm(norm_Shannon_rarefy~ norm_RootTissueDensity +  norm_SRL + norm_RootDiameter + MEM1+MEM2+MEM3+MEM4, env.scale)
summary(lm.root.ITS)
vif(lm.root.ITS) #nothing to remove all <5
lm.root.ITS.step<-stepAIC(lm.root.ITS,direction="both")
vif(lm.root.ITS.step) # <5
sum.root.its <- summary(lm.root.ITS.step)
sum.root.its
sum.root.its
write.csv(table, "Shannon_root_fungi_rarefy.csv")
table <- data.frame(summ(lm.root.ITS.step)$coeftable)
write.csv(table, "Shannon_root_fungi_rarefy.csv")
leaf_rarefy
leaf_rarefy_df
hill <- hill_taxa_parti_pairwise(leaf_rarefy_df,q=1,output="matrix", pairs = "full")
hill.beta.leaf  <- hill$TD_beta
hill.beta.leaf.dist <- as.dist(hill.beta.leaf)
#hill.dist  <- dist(hill.dist)   #dist() will actually calculate the distance matrix whereas as.dist() only will try to coerce a object to a distance matrix.
mod <- betadisper(d = hill.beta.dist, group = as.factor(natura_clean$samples$organ), type = "median")
#hill.dist  <- dist(hill.dist)   #dist() will actually calculate the distance matrix whereas as.dist() only will try to coerce a object to a distance matrix.
mod <- betadisper(d = hill.beta.leaf.dist, group = as.factor(natura_clean$samples$organ), type = "median")
dim(leaf_rarefy_df)
dim(root_rarefy_df)
rownames(leaf_rarefy_df)
rownames(root_rarefy_df)
leaf_rarefy_df$Group <- rownames(root_rarefy_df)
leaf_rarefy_df$Group <- rownames(leaf_rarefy_df)
root_rarefy_df$Group <- rownames(root_rarefy_df)
left_join(leaf_rarefy_df, root_rarefy_df, by = "Group")
natura_rarefy <- left_join(leaf_rarefy_df, root_rarefy_df, by = "Group")
natura_rarefy <- natura_rarefy[,-1]
natura_rarefy <- left_join(leaf_rarefy_df, root_rarefy_df, by = "Group")
names(natura_rarefy)
natura_rarefy <- natura_rarefy %>% dplyr::select(-Group)
natura_rarefy <- left_join(leaf_rarefy_df, root_rarefy_df, by = "Group")
natura_rarefy <- natura_rarefy %>% dplyr::select(-Group)
hill <- hill_taxa_parti_pairwise(natura_rarefy,q=1,output="matrix", pairs = "full")
natura_rarefy <- left_join(leaf_rarefy_df, root_rarefy_df, by = "Group")
natura_rarefy <- natura_rarefy %>% dplyr::select(-Group) %>%
as.matrix()
hill <- hill_taxa_parti_pairwise(natura_rarefy,q=1,output="matrix", pairs = "full")
View(natura_rarefy)
View(natura_clean)
natura_clean[["reads"]]
rownames(natura_clean$reads)
rownames(natura_rarefy)
natura_rarefy <- left_join(leaf_rarefy_df, root_rarefy_df, by = "Group")
rownames(natura_rarefy)
rownames(natura_rarefy)
rownames(natura_rarefy) <- natura_rarefy$Group
rownames(natura_rarefy)
natura_rarefy <- natura_rarefy %>% dplyr::select(-Group) %>%
as.matrix()
rownames(natura_rarefy)
hill <- hill_taxa_parti_pairwise(natura_rarefy,q=1,output="matrix", pairs = "full")
#traits normalized
traits_norm <- read_csv("resources/DRYER_natura_imputed_traits_norm.csv")
traits_norm$code <- as.character(traits_norm$code)
names(traits_norm)
leaf$samples <- left_join(leaf$samples, traits_norm %>% dplyr::select(code, norm_gmin, norm_LSWC,norm_LT,norm_SLA, norm_StomatalDensity,norm_TotalLeafArea))
#traits
names(leaf$samples)
env <- leaf$samples[,c(13,39:42,47:52)] #only leaf traits and spatial predictors
# Prior to constructing the model, root functional trait variables were mean-centered and scaled to unit variance.
names(env)
env.scale <- scale(env[,-c(1)], center = TRUE, scale = TRUE) #scale traits not the indices
env.scale <-as.data.frame(env.scale)
Name <- env[,c(1)]
env.scale <- cbind(env.scale, Name)
names(env.scale)
leaf_rarefy_df
leaf_dist <-hill_taxa_parti_pairwise(leaf_rarefy_df,q=1,output="matrix", pairs = "full")
load("E:/Sophie_pipeline/obitools/resources/Metabarlist_natura_clean_ITS2_traits.Rdata")
leaf <- subset_metabarlist(natura_clean, table = "samples",
indices = natura_clean$samples$organ == "leaf")
leaf_data <- leaf$reads
leaf_data <- as.data.frame(leaf_data)
essai <-  leaf_data %>%
rownames_to_column(var = "group") %>%
pivot_longer(cols = -group)
min_n_seqs <- essai %>%
group_by(group)%>%
summarize(nseq=sum(value))%>%
summarize(min = min(nseq)) %>%
pull(min) # 6317
essai_df <- essai %>% pivot_wider(names_from = "name", values_from = "value") %>%
as.data.frame()
rownames(essai_df) <- essai_df$group
essai <- essai_df[,-1]
rarefy(essai, min_n_seqs) %>%
as_tibble(rownames="Group") %>%
dplyr::select(Group, vegan=value)
leaf_rarefy <- rrarefy(essai, min_n_seqs) %>%
as_tibble(rownames = "Group") %>%
pivot_longer(-Group)
leaf_rarefy_df <- leaf_rarefy %>% pivot_wider(names_from = "name", values_from = "value") %>%
as.data.frame()
rownames(leaf_rarefy_df) <- leaf_rarefy_df$Group
leaf_rarefy_df <- leaf_rarefy_df[,-1]
leaf_dist <-hill_taxa_parti_pairwise(leaf_rarefy_df,q=1,output="matrix", pairs = "full")
#We are only interested to retrieve beta-diversity, found in TD_beta
null_model <- dbrda(leaf_dist$TD_beta~ 1, data = env.scale) # model containing only species matrix and intercept
full_model <- dbrda(leaf_dist$TD_beta ~ ., data = env.scale) # model including all variables
#check collinearity with VIF.cca (<10)
leaf_fun_1 <- ordiR2step (null_model, scope = formula (full_model), direction = c("both", "backward", "forward"))
leaf_fun_1
summary(leaf_fun_1)
set.seed(1234) ;leaf_fun_1$anova
vif.cca(leaf_fun_1)
# Extract the estimates from the most parsimonious model
rsquare_ITS_leaf <- leaf_fun_1$anova
# Create a data frame for plotting
rsquare_ITS_leaf  <- data.frame(Trait = row.names(rsquare_ITS_leaf ), Adj.R.squared = rsquare_ITS_leaf [, 1])
#because it's cumulative
rsquare_ITS_leaf[2,2]  <- rsquare_ITS_leaf[2,2] - rsquare_ITS_leaf[1,2]
rsquare_ITS_leaf $traits <- c( "Host species",  "gmin", "All variables")
all_trait <- data.frame(traits = c("Host species", "gmin", "LSWC", "LT", "SLA", "Stomatal density", "Total_LA", "MEM1", "MEM2", "MEM3", "MEM4", "All variables"))
rsquare_ITS_leaf <- left_join(all_trait, rsquare_ITS_leaf)
leaf_fungi
all_trait
rsquare_ITS_leaf
#traits normalized
traits_norm <- read_csv("resources/DRYER_natura_imputed_traits_norm.csv")
traits_norm$code <- as.character(traits_norm$code)
names(traits_norm)
root$samples <- left_join(root$samples, traits_norm %>% dplyr::select(code, norm_RootDiameter, norm_RootTissueDensity,norm_SRL))
#traits
names(root$samples)
env <- root$samples[,c(13,39:42,47:49)] #only root traits and spatial predictors
# Prior to constructing the model, root functional trait variables were mean-centered and scaled to unit variance.
names(env)
env.scale <- scale(env[,-c(1)], center = TRUE, scale = TRUE) #scale traits not the indices
env.scale <-as.data.frame(env.scale)
Name <- env[,c(1)]
env.scale <- cbind(env.scale, Name)
names(env.scale)
root_dist <-hill_taxa_parti_pairwise(root$reads,q=1,output="matrix", pairs = "full")
root_dist <-hill_taxa_parti_pairwise(root_rarefy_df,q=1,output="matrix", pairs = "full")
#root
root_rarefy_df <- root_rarefy %>% pivot_wider(names_from = "name", values_from = "value") %>%
as.data.frame()
rownames(root_rarefy_df) <- root_rarefy_df$Group
root_rarefy_df <- root_rarefy_df[,-1]
root_dist <-hill_taxa_parti_pairwise(root_rarefy_df,q=1,output="matrix", pairs = "full")
#We are only interested to retrieve beta-diversity, found in TD_beta
null_model <- dbrda(root_dist$TD_beta~ 1, data = env.scale) # model containing only species matrix and intercept
full_model <- dbrda(root_dist$TD_beta ~ ., data = env.scale) # model including all variables
#check collinearity with VIF.cca (<10)
root_fun_1 <- ordiR2step(null_model, scope = formula (full_model), direction = c("both"))
root_fun_1
summary(root_fun_1)
set.seed(1234) ;root_fun_1$anova
vif.cca(full_model)
root_fun_1
full_model <- dbrda(root_dist$TD_beta ~ ., data = env.scale) # model including all variables
#check collinearity with VIF.cca (<10)
root_fun_1 <- ordiR2step(null_model, scope = formula (full_model), direction = c("both"))
root_fun_1
summary(root_fun_1)
set.seed(1234) ;root_fun_1$anova
vif.cca(full_model)
